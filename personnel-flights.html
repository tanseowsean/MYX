<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <link rel="icon" href="images/favicon.png" type="image/png" sizes="16x16">
    <title>MYX Baggage Tracking System</title>
    <link rel="stylesheet" href="css/style.css">
    <link rel="stylesheet" href="css/responsive.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Open+Sans:wght@300;400;500&display=swap" rel="stylesheet">
</head>

<body>

    <div class="container">

        <!-- Header -->
        <header>
            <div class="logo"><img src="images/logoXS.png" alt=""></div>
            <div class="account">
                <div class="text">
                    Hello, Xuan
                    <a href="#" class="logout">Log Out</a>
                </div>
                <img src="images/user.png" alt="">
            </div>
        </header>
        <!-- /Header -->

        <!-- Menu -->
        <div class="menu">
            <a href="personnel-mainmenu.html" class="item">
                <div class="icon"><img src="images/icon-menu.png" alt=""></div>
                <div class="text">Main Menu</div>
            </a>
            <a href="personnel-checkin.html" class="item">
                <div class="icon"><img src="images/icon-checkin.png" alt=""></div>
                <div class="text">Check In</div>
            </a>
            <a href="personnel-flightsmain.html" class="item">
                <div class="icon"><img src="images/icon-plane.png" alt=""></div>
                <div class="text">Flights</div>
            </a>
            <a href="personnel-configure.html" class="item">
                <div class="icon"><img src="images/icon-gear.png" alt=""></div>
                <div class="text">Configure</div>
            </a>
            <a href="personnel-baggage.html" class="item">
                <div class="icon"><img src="images/icon-luggage.png" alt=""></div>
                <div class="text">Baggage</div>
            </a>
            <a href="personnel-analytics.html" class="item">
                <div class="icon"><img src="images/icon-data-analytics.png" alt=""></div>
                <div class="text">Analytics</div>
            </a>
        </div>
        <!-- /Menu -->

        <!-- Hamburger -->
        <div class="hamburger">
            <img src="images/hamburger.png" alt=""> MENU
        </div>
        <!--/Hamburger -->

        <!-- Mobile Menu -->
        <div class="mobile-menu">
            <a href="personnel-mainmenu.html" class="item">
                <div class="icon"><img src="images/icon-menu.png" alt=""></div>
                <div class="text">Main Menu</div>
            </a>
            <a href="personnel-checkin.html" class="item">
                <div class="icon"><img src="images/icon-checkin.png" alt=""></div>
                <div class="text">Check In</div>
            </a>
            <a href="personnel-flightsmain.html" class="item">
                <div class="icon"><img src="images/icon-plane.png" alt=""></div>
                <div class="text">Flights</div>
            </a>
            <a href="personnel-configure.html" class="item">
                <div class="icon"><img src="images/icon-gear.png" alt=""></div>
                <div class="text">Configure</div>
            </a>
            <a href="personnel-baggage.html" class="item">
                <div class="icon"><img src="images/icon-luggage.png" alt=""></div>
                <div class="text">Baggage</div>
            </a>
            <a href="personnel-analytics.html" class="item">
                <div class="icon"><img src="images/icon-data-analytics.png" alt=""></div>
                <div class="text">Analytics</div>
            </a>
            <div class="close"><img src="images/close.png" alt=""></div>
        </div>
        <!-- /Mobile Menu -->

        <!-- Content-Area -->
        <div class="content">

            <div class="main-title">
                Flights

                <div class="subtitle">
                    Swipe the table to view more details
                </div>
            </div>

            <!-- display flights -->
            <div class="table-wrapper">
                <table class="pTable" cellspacing="0" cellpadding="0" width="100%">
                    <thead>
                        <th>No.</th>
                        <th>Flight ID</th>
                        <th>Aircraft</th>
                        <th>Flight Date</th>
                        <th>Departure Location</th>
                        <th>Arrival Location</th>
                        <th>Departure Time</th>
                        <th>Arrival Time</th>
                        <th>Status</th>
                    </thead>
                    <tbody id="tbodyFlights"></tbody>
                </table>
            </div>
            <!-- /display flights -->

        </div>
        <!-- /Content-Area -->

        <!-- Footer -->
        <footer>
            <div class="logo">
                <img src="images/logo-wt.png" alt="">
            </div>
            <div class="copyright">
                Copyright Â© MYX Baggage Tracking System 2023 All Rights Reserved.
            </div>
        </footer>
        <!-- /Footer -->

    </div>

    <script src="https://www.gstatic.com/firebasejs/8.2.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.2.1/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.2.1/firebase-firestore.js"></script>

    <script id="firebaseScript">
        const firebaseConfig = {
            apiKey: "AIzaSyAsIlkYQFu9rExzhdpG5HHfnhEI66Unj-4",
            authDomain: "myx-baggage.firebaseapp.com",
            projectId: "myx-baggage",
            storageBucket: "myx-baggage.appspot.com",
            messagingSenderId: "342593572959",
            appId: "1:342593572959:web:4eac93d796cfa787000bea",
            measurementId: "G-5SKV7NKZY1"
        };

        firebase.initializeApp(firebaseConfig);
        let db = firebase.firestore();

        //function to retrieve data
        function getAllData() {
            db.collection("flights").get().then((querySnapshot) => {
                var flights = [];
                var allID = [];
                querySnapshot.forEach(doc => {
                    flights.push(doc.data());
                    allID.push(doc.id);
                });
                // console.log(querySnapshot);
                // console.log(flights);
                addAllItemToTable(allID, flights);
            });
        }

        //function to update data in real time whenever there are changes in database record
        function getAllDataRealtime() {
            db.collection("flights").onSnapshot((querySnapshot) => {
                var flights = [];
                var allID = [];
                querySnapshot.forEach(doc => {
                    flights.push(doc.data());
                    allID.push(doc.id);
                });
                // console.log(querySnapshot);
                // console.log(flights);
                addAllItemToTable(allID, flights);
            });
        }

        //function to display data on website page table
        var flightNo = 0;
        var tbody = document.getElementById('tbodyFlights');

        function addItemToTable(flightID, aircraft, flightDate, departLocation, arriveLocation, departTime, arriveTime, status) {
            var trow = document.createElement('tr');
            var td1 = document.createElement('td');
            var td2 = document.createElement('td');
            var td3 = document.createElement('td');
            var td4 = document.createElement('td');
            var td5 = document.createElement('td');
            var td6 = document.createElement('td');
            var td7 = document.createElement('td');
            var td8 = document.createElement('td');
            var td9 = document.createElement('td');

            td1.innerHTML = ++flightNo;
            td2.innerHTML = flightID;
            td3.innerHTML = aircraft;
            td4.innerHTML = flightDate;
            td5.innerHTML = departLocation;
            td6.innerHTML = arriveLocation;
            td7.innerHTML = departTime;
            td8.innerHTML = arriveTime;
            td9.innerHTML = status;

            trow.appendChild(td1);
            trow.appendChild(td2);
            trow.appendChild(td3);
            trow.appendChild(td4);
            trow.appendChild(td5);
            trow.appendChild(td6);
            trow.appendChild(td7);
            trow.appendChild(td8);
            trow.appendChild(td9);

            tbody.appendChild(trow);
        }

        function addAllItemToTable(FlightsIDList, FlightsDocList) {
            flightNo = 0;
            tbody.innerHTML = "";
            FlightsDocList.forEach(element => {
                addItemToTable(FlightsIDList[flightNo], element.aircraft, element.flightDate, element.departLocation, element.arriveLocation, element.departTime, element.arriveTime, element.flightStatus);
            });
        }

        window.onload = getAllDataRealtime;
    </script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.4/jquery.min.js"></script>
    <script src="js/main.js"></script>
</body>

</html>